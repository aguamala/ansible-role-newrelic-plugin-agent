version: '2'

services:
  #service-discovery service runs in docker1 network by default
  newrelic-plugin-agent:
    container_name: newrelic-plugin-agent
    image: aguamala/newrelic-plugin-agent:{{ newrelic_plugin_agent.tag | default('latest') }}
    hostname: {{ hostname_replaced }}
    restart: {{ newrelic_plugin_agent.restart }}
    privileged: true
    #depends_on:
    # - consul
    extra_hosts:
     - "consul:{{ ansible_default_ipv4.address }}"
    volumes:
     - ./consul-template:/etc/consul-template
     - ./newrelic-plugin-agent.cfg:/opt/newrelic-plugin-agent/newrelic-plugin-agent.cfg

networks:
  default:
    external:
      name: {{ newrelic_plugin_agent_docker_network | default('bridge') }}
